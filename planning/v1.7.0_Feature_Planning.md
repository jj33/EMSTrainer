# EMSTrainer v1.7.0 - Feature Planning Document

**Target Release:** Q2 2025  
**Status:** Planning Phase  
**Previous Release:** v1.6.0 (January 7, 2025)

---

## üéØ Release Goals

v1.7.0 focuses on **enhanced realism** and **security** while maintaining the chat-based simplicity that makes EMSTrainer accessible.

### Core Themes:
1. **Equipment Realism** - Add timing delays and setup requirements
2. **Security & Integrity** - Scenario/results encryption and validation
3. **Instructor Tools** - In-prompt scenario editor and test generation
4. **Multi-Agency Dynamics** - Fire, Police, First Responder integration

---

## üöÄ Priority 1 Features (Must-Have)

### 1. Equipment Timing Delays

**Description:** Realistic setup and calibration times for medical equipment.

**Implementation:**

**LUCAS Device:**
- Setup time: 30-45 seconds (verbalized)
- Student must state: "Partner, position LUCAS device"
- Grading check: Did student account for setup delay?
- CPR must continue during setup (delegated to partner)

**Capnography (EtCO‚ÇÇ):**
- Monitor activation: 15 seconds
- Calibration time: 10-15 seconds
- Student must verbalize: "Enable capnography on monitor"
- Hidden grading: Did student activate early enough?
- Penalty if not activated before needed

**12-Lead ECG:**
- Electrode placement: 20-30 seconds
- Acquisition time: 15-20 seconds
- Student must delegate or perform
- Total time: ~45 seconds minimum

**IV Pump Programming:**
- Setup time: 15-30 seconds
- Student must verbalize dose/rate
- Grading: Did student calculate correctly?

**Ventilator Setup:**
- Assembly and connection: 60-90 seconds
- Settings verification: 15-30 seconds
- Total: ~2 minutes minimum

**Status:** High Priority - v1.7.0

---

### 2. Scenario Encryption

**Description:** Encrypt scenario files to prevent students from reading ahead or tampering.

**Implementation:**

**Phase 1 (v1.7.0):**
- AES-256 encryption for scenario JSON files
- Password-based encryption (instructor sets password)
- Encrypted files have `.emsx` extension
- Decryption happens in chat when student loads scenario

**Phase 2 (v1.8.0):**
- Digital signatures for tamper detection
- Per-student unique encrypted scenarios
- Timestamp validation

**Workflow:**
1. Instructor creates scenario
2. AI encrypts with password: "Encrypt this scenario with password: [password]"
3. Instructor distributes `.emsx` file to students
4. Student loads file in chat: [drag/drop .emsx file]
5. Student enters password when prompted
6. AI decrypts and runs scenario

**Security Features:**
- Cannot view JSON contents without decryption
- Prevents students from seeing expected actions/grading
- Prevents modification of vitals, timings, etc.

**Status:** High Priority - v1.7.0

---

### 3. In-Prompt Scenario Editor

**Description:** Allow instructors to edit scenarios via natural language without touching JSON.

**Workflow:**
```
Instructor: [drops scenario_cardiac_arrest_vf.json]
AI: "Loaded: Cardiac Arrest VF - Standard Mode
     Initial Vitals: HR 0, BP 0/0, SpO2 unmeasurable
     Key Events: 3
     Grading Categories: 8
     What would you like to modify?"

Instructor: "Change to Monica Mode and add equipment failure at 8 minutes"
AI: "Updated:
     - Difficulty: Monica Mode
     - Equipment failures: 35% probability
     - Added: Monitor battery failure at T-08:00
     Save as new file?"

Instructor: "Save as cardiac_arrest_vf_monica.json"
AI: [creates new file with changes]
```

**Editable Elements:**
- Difficulty level
- Initial vitals
- Patient demographics
- Timeline events (add/remove/modify)
- Curveball triggers
- Equipment failure probability
- Grading weights
- Time limits

**Validation:**
- AI checks for logical consistency
- Warns about conflicts (e.g., impossible vitals)
- Suggests improvements
- Validates JSON structure before saving

**Status:** High Priority - v1.7.0

---

### 4. Results Encryption

**Description:** Encrypt student submission files to prevent tampering.

**Implementation:**
- Student submissions saved as `.subx` encrypted files
- Hash validation for integrity checking
- Timestamp verification
- Student ID/name embedded

**Security:**
- Cannot modify scores without breaking encryption
- Cannot change timestamps
- Cannot fake completion
- Instructor decrypts for grading

**Status:** Medium Priority - v1.7.0

---

## üé® Priority 2 Features (Should-Have)

### 5. Instructor Test Generator

**Description:** Generate custom tests on any topic via natural language.

**Features:**
- Topic-specific tests: "Generate test on ALS airway management"
- Skill-level targeting: "BLS test for EMT students"
- Question count control: "20 questions on cardiology"
- Difficulty levels: Easy/Standard/Hard/NREMT-level
- Mixed topics: "Cardiology (10q), Trauma (10q), Airway (5q)"

**Question Types:**
- Multiple choice
- Scenario-based
- True/false
- Mixed formats

**Output Options:**
- Student version (questions only)
- Instructor version (with answers and explanations)
- Auto-grading enabled
- Export as PDF or formatted text

**Use Cases:**
- Weekly quizzes on protocols
- Pre-shift knowledge checks
- Remediation for failed skills
- Certification prep
- Custom content matching local protocols

**Status:** Medium Priority - v1.7.0

---

### 6. Instructor Study Guide Generator

**Description:** Create comprehensive study guides on specific topics.

**Features:**
- Natural language requests: "Create study guide on pediatric respiratory emergencies"
- Customizable depth: Brief overview or detailed deep-dive
- Includes: Key concepts, clinical applications, common pitfalls, NREMT tips
- Practice questions embedded
- Local protocol integration (if provided)

**Output:**
- Formatted markdown
- PDF export ready
- Student-friendly language
- Instructor notes section (optional)

**Status:** Medium Priority - v1.7.0

---

### 7. First Responders & Multi-Agency Dynamics

**Description:** Add Fire, Police, and First Responder resources to scenarios.

**Features:**

**Dynamic Arrival:**
- On-scene (already there)
- En route (ETA provided)
- Delayed (must request)
- Student must call for resources

**Fire Department:**
- Extrication ("Vehicle stable, 10 minutes to extrication")
- Scene safety (hazmat, structural)
- Manpower (lift assists, CPR)
- Equipment (ladders, tools, lighting)

**Police:**
- Scene control (crowd management)
- Traffic control
- Staging requirements (unsafe scenes)
- Evidence preservation
- Witness coordination

**First Responders:**
- Basic care already initiated
- CPR in progress
- Initial assessment completed
- Handoff report
- Assist with interventions

**Grading Integration:**
- Did student request appropriate resources?
- Did student coordinate care effectively?
- Did student stage when scene was unsafe?
- Did student utilize available personnel?

**Example:**
```
Scene: MVC with entrapment
Fire: On scene, performing extrication
Police: En route, ETA 3 minutes
First Responders: Maintaining c-spine

"Fire Captain approaches: 'Vehicle stable, but patient's trapped. 
We'll have them out in 8-10 minutes. What do you need from us?'"
```

**Status:** Medium Priority - v1.7.0

---

## üí° Priority 3 Features (Nice-to-Have)

### 8. Advanced Grading System

**Description:** Enhanced grading with partial credit and competency tracking.

**Features:**

**Partial Credit:**
- "Student attempted IV but failed - award 5/10 points"
- Recognition for proper technique even if unsuccessful
- Bonus points for excellent communication

**Competency Rubrics:**
- Track skill progression over multiple scenarios
- Identify improvement trends
- Flag persistent weaknesses

**Custom Criteria:**
- Add local protocol requirements
- Custom grading categories
- Adjust point weights per category

**Trend Analysis:**
- "Show John's improvement in airway management over time"
- Graph performance over 5+ scenarios
- Identify learning plateaus

**Remediation Flags:**
- Auto-suggest remediation topics based on failures
- "Student failed airway 3x - recommend Easy mode airway scenario"
- Generate targeted practice content

**Status:** Low Priority - v1.7.0 or v1.8.0

---

### 9. Custom Rubric Creation

**Description:** Allow instructors to create custom grading rubrics.

**Features:**

**Natural Language Creation:**
```
Instructor: "Create grading rubric for trauma scenario:
- Scene safety: 20 points (high emphasis)
- Airway: 15 points
- Circulation/hemorrhage control: 25 points (critical)
- Transport decision: 20 points
- Documentation: 20 points"
```

**Customization:**
- Adjust point values per category
- Add custom categories (local protocols)
- Set critical vs standard criteria
- Define pass/fail thresholds

**Reusability:**
- Save rubrics for future scenarios
- Apply to scenario generation
- Share with other instructors

**Status:** Low Priority - v1.7.0 or v1.8.0

---

### 10. Enhanced Reporting

**Description:** Advanced analytics and performance reports.

**Features:**
- Class performance summaries
- Individual student trends
- Skill competency dashboards
- Comparison to NREMT standards
- Export to CSV/PDF

**Status:** Low Priority - v1.8.0

---

## üõ†Ô∏è Technical Considerations

### Encryption Implementation

**Libraries:**
- Python: `cryptography` library
- JavaScript (future web): `crypto-js`
- Chat-based: Base64 encoding for transport

**Key Management:**
- Instructor-provided passwords (Phase 1)
- Key derivation function (PBKDF2)
- Salt generation for each file
- Future: PKI for automation (v1.8.0)

**File Format:**
```json
{
  "version": "1.7.0",
  "type": "encrypted_scenario",
  "algorithm": "AES-256-GCM",
  "encrypted_data": "base64_string",
  "salt": "base64_string",
  "iv": "base64_string",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

---

### Equipment Timing Implementation

**In Core.txt:**
- Add equipment timing constants
- Track equipment setup states
- Grading checks for proper sequencing

**Hidden Grading Items:**
- Did student verbalize equipment setup?
- Did student account for timing in care plan?
- Did student delegate appropriately during delays?

**Timing Penalties:**
- Minor: -2 points for not verbalizing
- Moderate: -5 points for forgetting to activate
- Major: -10 points for critical timing failure

---

### Multi-Agency Implementation

**In Scenario_Mode.txt:**
- Agency availability flags
- Response time calculations
- Dynamic dialogue generation
- Resource coordination grading

**Configuration:**
```json
{
  "agencies": {
    "fire": {
      "available": true,
      "status": "on_scene",
      "eta_minutes": 0,
      "capabilities": ["extrication", "hazmat", "manpower"]
    },
    "police": {
      "available": true,
      "status": "en_route",
      "eta_minutes": 3,
      "capabilities": ["scene_control", "traffic", "crowd"]
    },
    "first_responders": {
      "available": true,
      "status": "on_scene",
      "care_initiated": ["c_spine", "oxygen"]
    }
  }
}
```

---

## üìã Testing Requirements

### Equipment Timing Tests
- Verify timing delays work correctly
- Test grading for equipment setup
- Validate penalty calculations
- Test delegation scenarios

### Encryption Tests
- Encrypt/decrypt scenario files
- Test password validation
- Verify tamper detection
- Test with various file sizes

### Multi-Agency Tests
- Test all agency types
- Verify ETA calculations
- Test resource coordination grading
- Validate dialogue generation

### Scenario Editor Tests
- Test all edit operations
- Verify validation logic
- Test file save/load
- Validate JSON structure

---

## üìÖ Release Timeline

### Phase 1: Equipment & Security (Weeks 1-4)
- Equipment timing delays implementation
- Basic scenario encryption (password-based)
- Results encryption
- Testing and validation

### Phase 2: Instructor Tools (Weeks 5-8)
- In-prompt scenario editor
- Test generator
- Study guide generator
- Documentation updates

### Phase 3: Multi-Agency (Weeks 9-10)
- Fire/Police/FR integration
- Dynamic resource management
- Coordination grading
- Example scenarios

### Phase 4: Polish & Release (Weeks 11-12)
- Beta testing
- Bug fixes
- Documentation finalization
- Package and deploy

**Target Release:** End of Q2 2025

---

## üìù Documentation Updates Required

### Student Documentation:
- How to load encrypted scenarios
- Understanding equipment timing delays
- Multi-agency interaction tips
- Updated FAQ

### Instructor Documentation:
- Scenario encryption guide
- In-prompt editor tutorial
- Test/study guide generation examples
- Multi-agency configuration
- Custom rubric creation

### Technical Documentation:
- Encryption specification
- Equipment timing constants
- API for future integrations
- File format specifications

---

## üîÑ Migration from v1.6.0

### Backward Compatibility:
- ‚úÖ Unencrypted scenarios still work
- ‚úÖ Existing grading rubrics compatible
- ‚úÖ No breaking changes to Core.txt interface
- ‚úÖ Optional features (encryption, equipment timing)

### Upgrade Path:
- Load new prompt files (Core v1.7.0, Scenario v1.7.0)
- Existing scenarios work as-is
- Optional: Re-encrypt scenarios for security
- Optional: Enable equipment timing per scenario

---

## ‚ùì Open Questions

1. **Encryption Key Distribution:** How do instructors securely share passwords with students?
   - Email? (insecure)
   - In-person? (best but inconvenient)
   - LMS integration? (future consideration)

2. **Equipment Timing Customization:** Should instructors be able to adjust timing constants?
   - Per-scenario override?
   - Global settings file?
   - Hardcoded in prompts?

3. **Multi-Agency Default Behavior:** Should agencies be opt-in or always present?
   - Opt-in: Cleaner for simple scenarios
   - Always present: More realistic
   - Per-scenario flag?

4. **Test Generator Scope:** How many questions should be generated at once?
   - Limit: 5-20 questions per request?
   - Unlimited?
   - Configurable by instructor?

---

## üéØ Success Metrics

### v1.7.0 will be successful if:
- ‚úÖ Equipment timing adds realism without frustration
- ‚úÖ Encryption prevents 80%+ of student tampering attempts
- ‚úÖ In-prompt editor used by 50%+ of instructors
- ‚úÖ Test generator creates NREMT-quality questions
- ‚úÖ Multi-agency scenarios feel realistic
- ‚úÖ No breaking changes for v1.6.0 users
- ‚úÖ Documentation clear and comprehensive

### Metrics to Track:
- Feature adoption rates
- User feedback scores
- Bug reports per feature
- Time saved vs v1.6.0 workflow
- Student engagement increase

---

## üöß Known Risks & Mitigations

### Risk: Encryption complexity overwhelms instructors
**Mitigation:** Make encryption optional, provide clear guides, offer templates

### Risk: Equipment timing feels tedious
**Mitigation:** Make timing realistic but not frustrating, allow skip in Easy mode

### Risk: Multi-agency adds too much complexity
**Mitigation:** Default to off, opt-in per scenario, provide examples

### Risk: Feature creep delays release
**Mitigation:** Stick to Priority 1 & 2 only, move Priority 3 to v1.8.0

---

## üìö References

- [v1.6.0 Release Notes](../RELEASE_NOTES_v1.6.0.md)
- [Future Ideas Document](EMS_Trainer_Future_Ideas_with_Status.md)
- [Feature Document](EMSTrainer_Feature_Document.md)
- [Architecture Refactor Map](v1.6.1_Architecture_Refactor_Map.md)

---

**Document Status:** Draft - Planning Phase  
**Last Updated:** January 15, 2025  
**Next Review:** Weekly during development

---

*Ready to begin v1.7.0 development!***
